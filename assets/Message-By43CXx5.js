import{j as I}from"./jsx-runtime-D_zvdyIk.js";import{a as de,r as S}from"./iframe-zpiOQtGo.js";import{u as oe,p as fe,a as ie,b as me,i as ye,r as ve}from"./index-B0qy4s_C.js";import{a as pe}from"./animate.module-CI42XwLX.js";const ge="_message_sxnkl_37",_e="_nickname_sxnkl_71",$e="_text_sxnkl_107",se={message:ge,nickname:_e,text:$e};var E={},ce;function he(){if(ce)return E;ce=1,Object.defineProperty(E,"__esModule",{value:!0});var _=de();function J(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var r=J(_);const A=.3,h="linear",j="normal",k="none",O="running",W="paused",H="all";var G=({duration:e=A,delay:t=0,overlay:n=0})=>e+t-n||0,M=e=>e===void 0;function L(e,t,n){return M(t)&&M(e)?n||0:e&&e>=0?e:t||0}const q=r.createContext({animationStates:{},register:()=>{}});function Q({play:e,sequences:t=[],children:n}){const[i,l]=r.useState({}),d=r.useRef({}),o=r.useCallback(s=>{const{sequenceIndex:a,sequenceId:f}=s;(!M(f)||!M(a))&&(d.current[L(a,f)]=s)},[]);return r.useEffect(()=>{const s=Array.isArray(t)&&t.length?t:Object.values(d.current),a={};(e?s:[...s].reverse()).reduce((f,{sequenceId:y,sequenceIndex:v,duration:p=A,delay:c,overlay:u},m)=>{const g=L(v,y,m),T=G({duration:p,delay:c,overlay:u})+f;return a[g]={play:e,pause:!e,delay:(c||0)+f,controlled:!0},T},0),l(a)},[e]),r.createElement(q.Provider,{value:{animationStates:i,register:o}},n)}var X=e=>(e||0)*1e3;function ee(e){const{play:t,children:n,render:i,start:l,end:d,complete:o="",onComplete:s,delay:a=0,duration:f=A,easeType:y=h,sequenceId:v,sequenceIndex:p}=e,c=r.useRef(),[u,m]=r.useState(l||{}),{register:g,animationStates:$={}}=r.useContext(q),T=L(p,v);return r.useEffect(()=>{(!M(p)&&p>=0||v)&&g(e)},[]),r.useEffect(()=>{const R=$[T]||{};return m({...t||R.play?d:l,transition:`${H} ${f}s ${y} ${R.delay||a}s`}),t&&(o||s)&&(c.current=setTimeout(()=>{o&&m(o),s&&s()},X((R.delay||a)+f))),()=>c.current&&clearTimeout(c.current)},[T,$,t,f,y,a,s,l,d,o]),i?i({style:u}):r.createElement("div",{style:u},n)}var ae=e=>e?e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`):"";const U=e=>{const t=e.length;return e.reduce((n,i,l)=>{const d=parseFloat((100/(t-1)).toFixed(2))*l;if(typeof i=="string")return`${n} ${d}% {${i}}`;const o=Object.keys(i);if(o.length&&isNaN(+o[0])){const s=o.reduce((a,f)=>`${a} ${ae(f)}: ${i[f]};`,"");return`${n} ${d}% {${s}}`}return`${n} ${o[0]}% {${i[o[0]]}}`},"")};function K({keyframes:e,animationName:t}){return`@keyframes ${t} {${U(e)}}`}function w({keyframes:e,animationName:t}){var n,i,l,d;let o=document.querySelector("style[data-id=rsi]");o||(o=document.createElement("style"),o.setAttribute("data-id","rsi"),document.head.appendChild(o));const s=(l=(i=(n=o.sheet)===null||n===void 0?void 0:n.cssRules)===null||i===void 0?void 0:i.length)!==null&&l!==void 0?l:0;try{(d=o.sheet)===null||d===void 0||d.insertRule(K({keyframes:e,animationName:t}),s)}catch(a){console.error("react simple animate, error found during insert style ",a)}return{styleTag:o,index:s}}var N=(e,t)=>{if(!e)return;const n=Object.values(e.cssRules).findIndex(({name:i})=>i===t);n>=0&&e.deleteRule(n)},C=()=>`RSI-${Math.random().toString(36).substr(2,9)}`,z=e=>e?W:O;function B(e){const{children:t,play:n=!1,pause:i=!1,render:l,duration:d=A,delay:o=0,easeType:s=h,direction:a=j,fillMode:f=k,iterationCount:y=1,sequenceIndex:v,keyframes:p,sequenceId:c}=e;let u;const m=r.useRef({forward:"",reverse:""}),g=r.useRef(!1),$=r.useRef({forward:null,reverse:null}),T=L(v,c),{register:R,animationStates:D={}}=r.useContext(q),b=D[T]||{},[,re]=r.useState(!1);r.useEffect(()=>{const Y=$.current,Z=m.current;m.current.forward=C();let P=w({animationName:m.current.forward,keyframes:p});return $.current.forward=P.styleTag,m.current.reverse=C(),P=w({animationName:m.current.reverse,keyframes:p.reverse()}),$.current.reverse=P.styleTag,R(e),n&&re(!0),()=>{var F,ne;N((F=Y.forward)===null||F===void 0?void 0:F.sheet,Z.forward),N((ne=Y.reverse)===null||ne===void 0?void 0:ne.sheet,Z.reverse)}},[]),b.controlled&&!g.current?(u=b.pause,b.pause||(g.current=!0)):u=i;const V={animation:`${d}s ${s} ${b.delay||o}s ${y} ${a} ${f} ${z(u)} ${((b.controlled?b.play:n)?m.current.forward:m.current.reverse)||""}`};return l?l({style:V}):r.createElement("div",{style:V||{}},t)}function x(e){const{start:t,end:n,complete:i,onComplete:l,delay:d=0,duration:o=A,easeType:s=h}=e,a=r.useMemo(()=>`${H} ${o}s ${s} ${d}s`,[o,s,d]),[f,y]=r.useState({isPlaying:!1,style:{...t,transition:a}}),{isPlaying:v,style:p}=f,c=r.useRef();return r.useEffect(()=>((l||i)&&v&&(c.current=setTimeout(()=>{l&&l(),i&&y(u=>({...u,style:i}))},X(d+o))),()=>c.current&&clearTimeout(c.current)),[f,i,d,o,v,l]),{isPlaying:v,style:p,play:r.useCallback(u=>{y(m=>({...m,style:{...u?n:t,transition:a},isPlaying:u}))},[n,t,a])}}function te(e){const{duration:t=A,delay:n=0,easeType:i=h,direction:l=j,fillMode:d=k,iterationCount:o=1,keyframes:s}=e,a=r.useRef({forward:"",reverse:""}),f=r.useRef({forward:null,reverse:null}),{register:y}=r.useContext(q),[v,p]=r.useState(null),[c,u]=r.useState(!1);return r.useEffect(()=>{const g=f.current,$=a.current;a.current.forward=C();let T=w({animationName:a.current.forward,keyframes:s});return f.current.forward=T.styleTag,a.current.reverse=C(),T=w({animationName:a.current.reverse,keyframes:s.reverse()}),f.current.reverse=T.styleTag,y(e),()=>{var R,D;N((R=g.forward)===null||R===void 0?void 0:R.sheet,$.forward),N((D=g.reverse)===null||D===void 0?void 0:D.sheet,$.reverse)}},[]),{style:{animation:`${t}s ${i} ${n}s ${o} ${l} ${d} ${z(c)} ${v===null?"":v?a.current.forward:a.current.reverse}`},play:p,pause:u,isPlaying:!!v}}function ue(e){return Array.from({length:e},()=>null)}function le(e){const{sequences:t=[]}=e,n=ue(t.length).map((y,v)=>e.sequences[v].start),[i,l]=r.useState(n),[d,o]=r.useState(!1),s=r.useRef([]),a=r.useRef([]);r.useEffect(()=>{t.forEach(({keyframes:p},c)=>{if(!Array.isArray(p))return;s.current[c]||(s.current[c]={},a.current[c]={}),s.current[c].forward=C();let u=w({animationName:s.current[c].forward,keyframes:p});a.current[c].forward=u.styleTag,s.current[c].reverse=C(),u=w({animationName:s.current[c].reverse,keyframes:p.reverse()}),a.current[c].reverse=u.styleTag});const y=a.current,v=s.current;return()=>Object.values(v).forEach(({forward:p,reverse:c},u)=>{var m,g;N((m=y[u].forward)===null||m===void 0?void 0:m.sheet,p),N((g=y[u].reverse)===null||g===void 0?void 0:g.sheet,c)})},[]);const f=r.useCallback(y=>{let v=0;const p=y?s.current:[...s.current].reverse(),c=(y?t:[...t].reverse()).map((u,m)=>{const{duration:g=A,delay:$=0,overlay:T,keyframes:R,iterationCount:D=1,easeType:b=h,direction:re=j,fillMode:V=k,end:Y={},start:Z={}}=u,P=m===0?$:v,F=`${H} ${g}s ${b} ${P}s`;return v=G({duration:g,delay:$,overlay:T})+v,R?{animation:`${g}s ${b} ${P}s ${D} ${re} ${V} ${O} ${y?p[m].forward:p[m].reverse}`}:{...y?Y:Z,transition:F}});l(y?c:[...c].reverse()),o(y)},[]);return{styles:i,play:f,isPlaying:d}}return E.Animate=ee,E.AnimateGroup=Q,E.AnimateKeyframes=B,E.useAnimate=x,E.useAnimateGroup=le,E.useAnimateKeyframes=te,E}var Te=he();const Se=({message:_,callback:J})=>{var B;const[r,A]=S.useState(!0),h=S.useRef(null),j=oe(x=>x.parser),k=oe(x=>x.parseToLink);if(!j||!k)return null;const[O]=S.useState(fe(_.message)),[W,H]=S.useState(ie(10,40)),[G,M]=S.useState(W*.7),[L,q]=S.useState(ie(.4,.6)),[Q,X]=S.useState(ye(_.colorHex??"white")?me(L):_.colorHex??"white"),[ee,ae]=S.useState(`linear-gradient(125deg, ${Q} , transparent 75%) border-box`),[U,K]=S.useState({visibility:"hidden",fontSize:W+"px",position:"absolute",background:_.isVip||_.isModerator||_.isBroadcaster?ee:void 0,margin:W/10+"px"}),[w,N]=S.useState(0),{play:C,style:z}=Te.useAnimate({duration:G,start:{...U,left:window.outerWidth+w+"px"},end:{...U,left:w*-1-100+"px"},onComplete:()=>{A(!1)}});return S.useEffect(()=>{const x=h.current,te=Math.floor(Math.random()*(window.innerHeight-x.offsetHeight));K({...U,top:te+"px",visibility:"visible",left:window.outerWidth+"px"})},[_.id]),S.useEffect(()=>{h.current&&h.current.offsetWidth&&(N(h.current.offsetWidth),K(x=>({...x,left:window.outerWidth+w+"px"}))),w!==0&&C(!0)},[(B=h.current)==null?void 0:B.offsetWidth]),r&&I.jsxs("div",{ref:h,style:z,className:se.message+" "+pe.animated,onAnimationEnd:J,children:[I.jsxs("div",{id:`${_.id}_nickname`,className:se.nickname,style:{color:_.colorHex},children:[_.displayName,":"]}),I.jsx("div",{className:se.text,style:{color:"white",marginLeft:"10px"},children:O==null?void 0:O.map(x=>{switch(x.type){case"text":return ve({text:_,parser:j,newParser:k});case"image":return I.jsx("span",{children:"Ссылка"});case"link":return I.jsx("span",{children:"Ссылка"});case"video":return I.jsx("span",{children:"Ссылка"})}})})]},_.id)};Se.__docgenInfo={description:"",methods:[],displayName:"Message",props:{message:{required:!0,tsType:{name:"ChatMessage"},description:""},callback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{Se as M};
