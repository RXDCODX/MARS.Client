# BackupsPage

Страница для управления резервными копиями базы данных MARS.

## Функциональность

### Основные возможности

1. **Создание бекапов**
   - Создание резервных копий указанной базы данных
   - Валидация названия базы данных
   - Отображение процесса создания с индикатором загрузки

2. **Управление бекапами**
   - Просмотр списка всех доступных бекапов
   - Информация о размере, дате создания и базе данных
   - Скачивание бекапов

3. **Очистка старых бекапов**
   - Автоматическое удаление старых бекапов
   - Настройка количества сохраняемых бекапов
   - Предотвращение потери важных данных

4. **Мониторинг статуса**
   - Общая статистика по бекапам
   - Количество, размер и дата последнего бекапа
   - Информация о папке хранения

5. **Настройки pg_dump**
   - Конфигурация подключения к базе данных (хост, порт, пользователь, пароль)
   - Настройки формата и сжатия бекапа
   - Дополнительные опции pg_dump (verbose, no-owner, no-privileges и др.)
   - Выбор кодировки и базы данных

6. **Настройки путей**
   - Настройка папки для сохранения бекапов
   - Временная папка для обработки
   - Папка для логов операций
   - Автоматическое создание директорий

### API интеграция

Страница использует `DatabaseBackup` API из `@/shared/api`:

- `databaseBackupCreateCreate()` - создание нового бекапа
- `databaseBackupListList()` - получение списка бекапов
- `databaseBackupDownloadList()` - скачивание бекапа
- `databaseBackupCleanupCreate()` - очистка старых бекапов
- `databaseBackupStatusList()` - получение статуса бекапов

### Toast уведомления

Все операции используют toast уведомления через `useToastModal`:

- Успешные операции показываются как success toast
- Ошибки показываются как error toast с детальной информацией
- Интеграция с модальным окном для детального просмотра

## Архитектура

### Структура файлов

```text
BackupsPage/
├── BackupsPage.tsx          # Основной компонент
├── BackupsPage.module.scss  # Стили
├── BackupsPage.types.ts     # TypeScript типы
├── index.ts                 # Экспорт
└── README.md               # Документация
```

### Компоненты

- **BackupsPage** - основной компонент с состоянием и логикой
- **Секция управления** - формы для создания и очистки бекапов
- **Секция статуса** - статистика и метрики
- **Список бекапов** - отображение всех доступных бекапов

### Состояние

```typescript
interface BackupsPageState {
  backups: BackupInfo[];           // Список бекапов
  status: BackupStatus | null;     // Статус системы
  isLoading: boolean;              // Загрузка списка
  isCreating: boolean;             // Создание бекапа
  isCleaning: boolean;             // Очистка бекапов
  isSavingSettings: boolean;       // Сохранение настроек
  error: string;                   // Текст ошибки
  createForm: CreateBackupForm;    // Форма создания
  cleanupForm: CleanupForm;        // Форма очистки
  pgDumpSettings: PgDumpSettings;  // Настройки pg_dump
  pathSettings: PathSettings;      // Настройки путей
  showSettings: boolean;           // Показать/скрыть настройки
}
```

## Стилизация

### Дизайн-система

- **Цветовая схема**: Градиенты и современные цвета
- **Типографика**: Адаптивные размеры шрифтов
- **Анимации**: Плавные переходы и hover эффекты
- **Адаптивность**: Responsive дизайн для всех устройств

### CSS модули

- Использование CSS модулей для изоляции стилей
- Переменные CSS для консистентности
- Медиа-запросы для адаптивности
- Flexbox и Grid для современной верстки

## Использование

### В роутере

```typescript
import BackupsPage from "@/Site/Pages/BackupsPage";

// В роутере
<Route path="/backups" element={<BackupsPage />} />
```

### Навигация

Добавьте ссылку в навигацию:

```typescript
{
  label: "Бекапы",
  path: "/backups",
  icon: "bi-database"
}
```

## Особенности реализации

### Моковые данные

Поскольку API возвращает `void`, используются моковые данные для демонстрации:

- Список бекапов с реалистичными данными
- Статистика на основе количества бекапов
- Форматирование дат и размеров файлов

### Обработка ошибок

- Try-catch блоки для всех API вызовов
- Пользовательские сообщения об ошибках
- Toast уведомления для обратной связи
- Состояние загрузки для всех операций

### Валидация

- Проверка заполнения обязательных полей
- Валидация числовых значений
- Предотвращение отправки пустых форм

## Будущие улучшения

1. **Реальные данные API**
   - Интеграция с реальными ответами сервера
   - Обработка различных форматов данных

2. **Дополнительные функции**
   - Восстановление из бекапа
   - Планирование автоматических бекапов
   - Сжатие и шифрование

3. **Улучшения UI/UX**
   - Drag & Drop для файлов
   - Прогресс-бары для операций
   - Фильтрация и поиск по бекапам
   - Импорт/экспорт настроек
   - Валидация путей и подключений
